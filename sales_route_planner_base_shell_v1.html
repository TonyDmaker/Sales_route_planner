<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Sales Route Planner — Base Shell v1</title>
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"/>
<style>
  /* Make sure nothing prevents the map from showing */
  html, body { height:100%; margin:0; }
  /* Map fills the viewport and sits at the lowest z-index */
  #map {
    position: fixed; /* not absolute: fixed avoids ancestor sizing pitfalls */
    top:0; left:0; right:0; bottom:0;
    z-index: 0;
  }
  /* Overlays float above the map */
  .panel {
    position: fixed; z-index: 10;
    background: rgba(255,255,255,0.98);
    border-radius: 12px; padding: 12px;
    font-family: system-ui, -apple-system, Segoe UI, Roboto, sans-serif;
    box-shadow: 0 2px 10px rgba(0,0,0,0.15);
    user-select: none; -webkit-user-select: none; -webkit-touch-callout: none;
  }
  .legend { top: 10px; left: 10px; }
  .toolbar {
    top: 60px; right: 10px; width: 320px; max-width: 92vw; max-height: 70vh;
    overflow: auto; display: none;
  }
  .toolbar.show { display: block; }
  .row { display:flex; align-items:center; gap:6px; margin:4px 0; }
  .btn {
    display:inline-block; padding:6px 10px; margin:2px 4px 2px 0; border:1px solid #ddd; border-radius:8px;
    background:#f7f7f7; cursor:pointer; user-select:none;
  }
  .fab {
    position: fixed; top: 10px; right: 10px; z-index: 20;
    width: 44px; height: 44px; border-radius: 50%; border: none;
    background: #111; color: #fff; font-size: 22px; line-height: 44px; text-align: center;
    box-shadow: 0 3px 10px rgba(0,0,0,0.3); cursor: pointer;
  }
</style>
</head>
<body>
  <div id="map"></div>

  <button id="menuBtn" class="fab" title="Settings">☰</button>

  <div class="panel legend" id="legendPanel">
    <div style="font-weight:700;margin-bottom:6px;">Legend</div>
    <div class="row">Pins and routes will appear here in next steps.</div>
  </div>

  <div class="panel toolbar" id="settingsPanel">
    <div style="display:flex;justify-content:space-between;align-items:center;">
      <div style="font-weight:700;">Settings</div>
      <button class="btn" id="closeSettings">Close</button>
    </div>
    <div class="row"><em>Base shell only</em> — map, menu, legend. We'll add features next.</div>
  </div>

  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
  <script>
    // Initialize Leaflet after DOM is ready
    const map = L.map('map', { zoomControl: true });
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
      attribution: '&copy; OpenStreetMap contributors'
    }).addTo(map);
    map.setView([37.773972,-122.431297], 13);
    if (navigator.geolocation) { map.locate({ setView:true, maxZoom:18 }); }
    // Make 100% sure it sizes correctly
    window.addEventListener('load', () => setTimeout(() => map.invalidateSize(), 100));

    // Menu
    const menuBtn = document.getElementById('menuBtn');
    const settings = document.getElementById('settingsPanel');
    menuBtn.addEventListener('click', () => settings.classList.toggle('show'));
    document.getElementById('closeSettings').addEventListener('click', () => settings.classList.remove('show'));
    // Tap on map hides menu
    document.addEventListener('pointerdown', (e) => {
      const t = e.target;
      if (!(t.closest('.toolbar') || t.closest('.fab') || t.closest('.leaflet-control'))) settings.classList.remove('show');
    }, {passive:true});
  </script>
</body>
</html>
